{% extends "base.html" %}

{% block title %}LearnWords - –†–µ–∑—É–ª—å—Ç–∞—Ç—ã —Ç–µ—Å—Ç–∞{% endblock %}

{% block content %}
<div class="container">
    <div class="row mb-4">
        <div class="col-md-8">
            <h1 class="h3">–†–µ–∑—É–ª—å—Ç–∞—Ç—ã —Ç–µ—Å—Ç–∞</h1>
            <p class="text-muted">–¢–µ—Å—Ç –∑–∞–≤–µ—Ä—à–µ–Ω {{ test_session.completed_at.strftime('%d.%m.%Y –≤ %H:%M') }}</p>
        </div>
        <div class="col-md-4 text-end">
            <a href="{{ url_for('main.new_test') }}" class="btn btn-primary">
                <i class="fas fa-redo me-1"></i> –ù–æ–≤—ã–π —Ç–µ—Å—Ç
            </a>
        </div>
    </div>
    
    <div class="row">
        <div class="col-md-8">
            <div class="card mb-4">
                <div class="card-header bg-primary text-white">
                    <h2 class="h5 mb-0">–†–µ–∑—É–ª—å—Ç–∞—Ç—ã —Ç–µ—Å—Ç–∞</h2>
                </div>
                <div class="card-body">
                    <div class="text-center mb-4">
                        <div class="display-1 mb-3">
                            <span class="badge {% if percentage >= 80 %}bg-success{% elif percentage >= 60 %}bg-warning{% else %}bg-danger{% endif %}">
                                {{ percentage | int }}%
                            </span>
                        </div>
                        <h3 class="h5">{{ test_session.correct_answers }} –∏–∑ {{ test_session.total_questions }} –ø—Ä–∞–≤–∏–ª—å–Ω—ã—Ö –æ—Ç–≤–µ—Ç–æ–≤</h3>
                        <p class="mb-0">–ü–æ–ª—É—á–µ–Ω–Ω—ã–µ –æ—á–∫–∏: <strong>{{ test_session.score }}</strong></p>
                    </div>
                    
                    <div class="progress mb-4" style="height: 20px;">
                        <div class="progress-bar bg-success" role="progressbar" 
                             style="width: {{ (test_session.correct_answers / test_session.total_questions * 100) | int }}%;" 
                             aria-valuenow="{{ (test_session.correct_answers / test_session.total_questions * 100) | int }}" 
                             aria-valuemin="0" aria-valuemax="100">
                            {{ (test_session.correct_answers / test_session.total_questions * 100) | int }}%
                        </div>
                    </div>
                    
                    <div class="row text-center mb-4">
                        <div class="col-md-4">
                            <div class="card bg-light">
                                <div class="card-body">
                                    <h3 class="h5">{{ test_session.difficulty }}</h3>
                                    <p class="text-muted mb-0">–°–ª–æ–∂–Ω–æ—Å—Ç—å</p>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-4">
                            <div class="card bg-light">
                                <div class="card-body">
                                    <h3 class="h5">{{ test_session.total_questions }}</h3>
                                    <p class="text-muted mb-0">–°–ª–æ–≤ –≤ —Ç–µ—Å—Ç–µ</p>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-4">
                            <div class="card bg-light">
                                <div class="card-body">
                                    <h3 class="h5">
                                        {% if test_session.session_type == 'daily' %}
                                            –ï–∂–µ–¥–Ω–µ–≤–Ω—ã–π
                                        {% elif test_session.session_type == 'thematic' %}
                                            –¢–µ–º–∞—Ç–∏—á–µ—Å–∫–∏–π
                                        {% else %}
                                            –°–ª—É—á–∞–π–Ω—ã–π
                                        {% endif %}
                                    </h3>
                                    <p class="text-muted mb-0">–¢–∏–ø —Ç–µ—Å—Ç–∞</p>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="test-summary">
                        <h4 class="h6 mb-3">–°–ª–æ–≤–∞ –≤ —Ç–µ—Å—Ç–µ:</h4>
                        <div class="list-group">
                            {% set word_ids = test_session.words|from_json %}
                            {% for word_id in word_ids %}
                            <div class="list-group-item">
                                <div class="d-flex justify-content-between align-items-center">
                                    <div>
                                        <h5 class="mb-1">{{ words_dict[word_id].word }}</h5>
                                        <p class="mb-0 text-muted small">{{ words_dict[word_id].translation }}</p>
                                    </div>
                                    <a href="{{ url_for('main.word_detail', word_id=word_id) }}" class="btn btn-sm btn-outline-primary">–ü–æ–¥—Ä–æ–±–Ω–µ–µ</a>
                                </div>
                            </div>
                            {% endfor %}
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <div class="col-md-4">
            <div class="card mb-4">
                <div class="card-header bg-success text-white">
                    <h3 class="h5 mb-0">–ß—Ç–æ –¥–∞–ª—å—à–µ?</h3>
                </div>
                <div class="card-body">
                    <div class="d-grid gap-3">
                        <a href="{{ url_for('main.review') }}" class="btn btn-outline-primary">
                            <i class="fas fa-sync-alt me-1"></i> –ü–æ–≤—Ç–æ—Ä–µ–Ω–∏–µ —Å–ª–æ–≤
                        </a>
                        <a href="{{ url_for('main.tests') }}" class="btn btn-outline-success">
                            <i class="fas fa-list-alt me-1"></i> –í—Å–µ —Ç–µ—Å—Ç—ã
                        </a>
                        <a href="{{ url_for('main.show_progress') }}" class="btn btn-outline-info">
                            <i class="fas fa-chart-line me-1"></i> –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞
                        </a>
                    </div>
                    
                    {% if percentage < 70 %}
                    <div class="alert alert-warning mt-4">
                        <h4 class="alert-heading h6">–°–æ–≤–µ—Ç</h4>
                        <p class="mb-0">–ü–æ–ø—Ä–æ–±—É–π—Ç–µ –ø–æ–≤—Ç–æ—Ä–∏—Ç—å —Å–ª–æ–≤–∞, —Å –∫–æ—Ç–æ—Ä—ã–º–∏ —É –≤–∞—Å –≤–æ–∑–Ω–∏–∫–ª–∏ —Ç—Ä—É–¥–Ω–æ—Å—Ç–∏, –ø–µ—Ä–µ–¥ —Å–ª–µ–¥—É—é—â–∏–º —Ç–µ—Å—Ç–æ–º.</p>
                    </div>
                    {% endif %}
                </div>
            </div>
            
            <div class="card">
                <div class="card-header bg-primary text-white">
                    <h3 class="h5 mb-0">–ü–æ–¥–µ–ª–∏—Ç—å—Å—è —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–º</h3>
                </div>
                <div class="card-body">
                    <div class="share-container p-3 bg-light rounded text-center mb-3">
                        <p class="mb-2">–Ø –ø—Ä–∞–≤–∏–ª—å–Ω–æ –æ—Ç–≤–µ—Ç–∏–ª –Ω–∞ <strong>{{ test_session.correct_answers }}</strong> –∏–∑ <strong>{{ test_session.total_questions }}</strong> –≤–æ–ø—Ä–æ—Å–æ–≤ –≤ LearnWords! üéì</p>
                        <p class="mb-0">–ú–æ–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç: <strong>{{ percentage | int }}%</strong></p>
                    </div>
                    
                    <div class="d-grid gap-2">
                        <button class="btn btn-outline-primary copy-result-btn" type="button">
                            <i class="fas fa-copy me-1"></i> –ö–æ–ø–∏—Ä–æ–≤–∞—Ç—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block scripts %}
<script>
    document.addEventListener('DOMContentLoaded', function() {
        // –ö–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞ –≤ –±—É—Ñ–µ—Ä –æ–±–º–µ–Ω–∞
        const copyBtn = document.querySelector('.copy-result-btn');
        const shareContainer = document.querySelector('.share-container');
        
        copyBtn.addEventListener('click', function() {
            const textToCopy = shareContainer.textContent.trim();
            
            navigator.clipboard.writeText(textToCopy)
                .then(() => {
                    copyBtn.textContent = '–°–∫–æ–ø–∏—Ä–æ–≤–∞–Ω–æ!';
                    copyBtn.classList.replace('btn-outline-primary', 'btn-success');
                    
                    setTimeout(() => {
                        copyBtn.innerHTML = '<i class="fas fa-copy me-1"></i> –ö–æ–ø–∏—Ä–æ–≤–∞—Ç—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç';
                        copyBtn.classList.replace('btn-success', 'btn-outline-primary');
                    }, 2000);
                })
                .catch(err => {
                    console.error('–û—à–∏–±–∫–∞ –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏—è: ', err);
                });
        });
    });
</script>
{% endblock %} 
 
 